

# GPT-3

## Model Config

**batch size**, **sequence length** and **vocabulary size** are fixed to 1024, 1024 and 51200 respectively. The data type is *float16*.

| #params | Hidden size | #layers | #heads | #gpus |
| ------- | ----------- | ------- | ------ | ----- |
| 350M    | 1024        | 24      | 16     | 1     |
| 760M    | 1536        | 24      | 16     | 2     |
| 1.3B    | 2048        | 24      | 32     | 4     |
| 2.6B    | 2560        | 32      | 32     | 8     |
| 6.7B    | 4096        | 32      | 32     | 16    |
| 15B     | 5120        | 48      | 40     | 32    |
| 39B     | 8192        | 48      | 64     | 64    |

## End-to-end evaluation results

*note*: results organized in (execution time/s, device mem/GB, compile time/s)

**Table 1: include pipeline**

| Config | alpa                   | ours                   |
| ------ | ---------------------- | ---------------------- |
| 760M   | (59.21, 14.49, 232.51) | (46.13, 30.27, 7.56)   |
| 1.3B   | (47.23, 24.83, 355.14) | (42.45, 20.68, 33.96)  |
| 2.6B   | (45.00, 13.20, 731.86) | (39.72, 24.74, 295.58) |
| 6.7B   | (46.19, 16.75, 832.01) | (45.17, 15.57, 1906.22)|

**Table 2: tensor parallelism only**

| Config | alpa                  | ours                    |
| ------ | --------------------- | ----------------------- |
| 350M   | (54.88, 26.50, 8.77)  | (56.03, 26.52,  0.37)   |
| 760M   | (51.06, 21.38, 27.04) | (52.14, 19.41,  2.00)   |
| 1.3B   | (47.83, 20.22, 25.86) | (47.84, 30.37, 14.91)   |
| 2.6B   | (55.10, 21.47, 65.88) | (69.92, 10.85, 36.91)   |
| 6.7B   | (84.16, 25.09, 65.21) | (61.79, 21.93, 226.11)  |

## AutoDist Details

Memory constraint set to 30 GB in most test cases.

For cases with \*, we set the memory constraint to 25GB.

For the case with runtime=-1, we cannot run the case due to two errors from Cube: multiref and rvd failed.

### Include pipeline

**760M**

|    |   estimation time/s |   runtime/s |   estimation memory/GB |   runtime memory/GB |   compile time/s |
|---:|--------------------:|------------:|-----------------------:|--------------------:|-----------------:|
|  1 |               65.37 |       56.58 |                   6.19 |                6.71 |             5.19 |
|  2 |               53.18 |       51.11 |                  10.26 |               10.88 |             5.66 |
|  4 |               49.13 |       46.74 |                  17.47 |               18.14 |             6.05 |
|  8 |               48.52 |       46.13 |                  29.56 |               30.27 |             7.56 |
| 16*|               53.86 |       53.47 |                  24.97 |               29.98 |             9.3  |
| 32*|               57.49 |       56.48 |                  24.81 |               27.5  |             9.59 |

**1.3B**

|    |   estimation time/s |   runtime/s |   estimation memory/GB |   runtime memory/GB |   compile time/s |
|---:|--------------------:|------------:|-----------------------:|--------------------:|-----------------:|
|  1 |               52.36 |       48.27 |                   8.03 |                8.99 |            28.99 |
|  2 |               45.59 |       43.48 |                  13.81 |               14.77 |            27.7  |
|  4 |               43.87 |       42.45 |                  20.03 |               20.68 |            33.96 |
|  8 |               44.3  |       -1    |                  24.98 |               -1    |            38.67 |
| 16*|               47.71 |       48.13 |                  24.86 |               30.35 |            48.31 |
| 32*|               48.96 |       48.03 |                  24.98 |               25.96 |            42.15 |

**2.6B**

|    |   estimation time/s |   runtime/s |   estimation memory/GB |   runtime memory/GB |   compile time/s |
|---:|--------------------:|------------:|-----------------------:|--------------------:|-----------------:|
|  1 |               46.32 |       46.45 |                   7.34 |                8.94 |           228.92 |
|  2 |               42.6  |       40.96 |                  12.58 |               14.26 |           248.44 |
|  4 |               41.48 |       39.72 |                  23.06 |               24.74 |           295.58 |
|  8 |               41.01 |       -1    |                  28.74 |               -1    |           436.54 |
| 16 |               42.68 |       -1    |                  29.89 |               -1    |           476.78 |
| 32 |               44.98 |       -1    |                  29.98 |               -1    |           394.06 |

**6.7B**

|    |   estimation time/s |   runtime/s |   estimation memory/GB |   runtime memory/GB |   compile time/s |
|---:|--------------------:|------------:|-----------------------:|--------------------:|-----------------:|
|  1 |               50.58 |       50.26 |                   7.94 |                9.92 |          1496.21 |
|  2 |               46.37 |       45.17 |                  13.54 |               15.57 |          1906.22 |
|  4 |               43.81 |       -1    |                  17.16 |               -1    |          1937.48 |
|  8 |               43.42 |       -1    |                  29.65 |               -1    |          2082.68 |
| 16 |               43.66 |       -1    |                  29.98 |               -1    |          1834.14 |
| 32 |               47.15 |       -1    |                  29.96 |               -1    |          1555.16 |

Remark:

### Tensor Parallelism Only

**350M**

|    |   estimation time/s |   runtime/s |   estimation memory/GB |   runtime memory/GB |   compile time/s |
|---:|--------------------:|------------:|-----------------------:|--------------------:|-----------------:|
|  1 |               82.23 |       71.08 |                   5.92 |                5.64 |             0.38 |
|  2 |               69.33 |       62.75 |                   8.91 |                8.63 |             0.39 |
|  4 |               62.98 |       58.48 |                  14.88 |               14.26 |             0.37 |
|  8 |               59.6  |       56.03 |                  26.84 |               26.52 |             0.37 |
| 16 |               64.73 |       62.61 |                  29.8  |               29.21 |             0.38 |
| 32 |               71.85 |       68.8  |                  29.43 |               26.36 |             0.3  |

**760M**

|    |   estimation time/s |   runtime/s |   estimation memory/GB |   runtime memory/GB |   compile time/s |
|---:|--------------------:|------------:|-----------------------:|--------------------:|-----------------:|
|  1 |               90.14 |       81.4  |                   4.96 |                5.02 |             0.79 |
|  2 |               65.31 |       66.03 |                   6.84 |                7.12 |             0.94 |
|  4 |               58.3  |       57.21 |                  10.65 |               11.22 |             1.07 |
|  8 |               53.8  |       52.14 |                  18.25 |               19.41 |             2    |
| 16*|               53.86 |       53.46 |                  24.97 |               29.78 |             3.31 |
| 32*|               57.49 |       56.42 |                  24.81 |               27.54 |             2.7  |

**1.3B**

|    |   estimation time/s |   runtime/s |   estimation memory/GB |   runtime memory/GB |   compile time/s |
|---:|--------------------:|------------:|-----------------------:|--------------------:|-----------------:|
|  1 |               79.5  |       83.84 |                   4.42 |                4.41 |             2.65 |
|  2 |               61.4  |       69.35 |                   6.25 |                6.3  |             3.96 |
|  4 |               55.88 |       57.85 |                   9.91 |               10.29 |             6    |
|  8 |               50.25 |       50.38 |                  17.2  |               19.65 |             9.78 |
| 16*|               47.71 |       48.08 |                  24.86 |               30.37 |            14.91 |
| 32*|               48.96 |       47.84 |                  24.98 |               25.76 |             9.29 |

**2.6B**

|    |   estimation time/s |   runtime/s |   estimation memory/GB |   runtime memory/GB |   compile time/s |
|---:|--------------------:|------------:|-----------------------:|--------------------:|-----------------:|
|  1 |               87.92 |      102.79 |                   4.3  |                4.58 |            17.57 |
|  2 |               70.56 |       80.51 |                   6.03 |                6.98 |            24.84 |
|  4 |               63.19 |       69.62 |                   9.5  |               10.85 |            36.91 |
|  8 |               53.25 |       -1    |                  15.94 |               -1    |            76.63 |
| 16 |               46.44 |       -1    |                  24.99 |               -1    |           115.04 |
| 32 |               46.38 |       -1    |                  24.98 |               -1    |            69.36 |

**6.7B**

|    |   estimation time/s |   runtime/s |   estimation memory/GB |   runtime memory/GB |   compile time/s |
|---:|--------------------:|------------:|-----------------------:|--------------------:|-----------------:|
|  1 |              107.5  |      127.41 |                   5.01 |                5.24 |            61.34 |
|  2 |               88.84 |      101.43 |                   6.84 |                7.78 |            79.19 |
|  4 |               77.33 |       89.68 |                  10.45 |               13.54 |           116.27 |
|  8 |               61.7  |       61.79 |                  19.2  |               21.93 |           226.11 |
| 16 |               50.44 |       -1    |                  24.16 |               -1    |           189.93 |
| 32 |               49.57 |       -1    |                  25    |               -1    |           138.96 |


## Alpa Details

Here we show the key hyperparameters of alpa under different config in both **table 1** and **table 2**.

**Details for table 1**

| Config | micro batch size | Recompute | num_auto_layers | forward_stage_layer_ids        | submesh_shapes                 | logical_mesh_shapes            | autosharding_option_dicts                    |
|:-------|:-----------------|:----------|:----------------|:-------------------------------|:-------------------------------|:-------------------------------|:-----------------------------------------------------|
| 350M*  | 32               | True      | 1               | [0]                            | [1, 1]                         | [1, 1]                         | {}                                                    |
| 760M   | 16               | True      | 6               | [0, 1, 2], [3, 4, 5]           | [1, 1], [1, 1]                 | [1, 1], [1, 1]                 | force_dp_dict,{}                             |
| 1.3B   | 64               | True      | 6               | [0, 1, 2, 3, 4, 5]             | [1, 4]                         | [4, 1]                         | force_dp_dict,{}                             |
| 2.6B   | 16               | True      | 8               | [0, 1, 2, 3], [4, 5, 6, 7]     | [1, 4], [1, 4]                 | [4, 1], [4, 1]                 | force_dp_dict,force_dp_dict                  |
| 6.7B   | 16               | True      | 8               | [0, 1], [2, 3], [4, 5], [6, 7] | [1, 4], [1, 4], [1, 4], [1, 4] | [4, 1], [4, 1], [4, 1], [4, 1] | force_dp_dict,{},force_dp_dict,force_dp_dict |
| 15B    | 8                | True      | 16              | [0, 1], [2, 3], [4, 5], [6, 7], [8, 9], [10, 11], [12, 13], [14, 15] | [1, 4]\*8  | [4, 1]\*8    | force_dp_dict \* 8 |

**15B**

| batch size | time/s | memory/GB | recompute |
| ---------- | -------| --------- | --------- |
| 2          | 75.77  | 21.94     | False     |
| 4          | 95.56  | 17.69     | True      |
| 8          | 59.98  | 18.10     | True      |
| 16         | 60.84  | 18.67     | True      |
| 32         | 70.05  | 23.32     | True      |
| 64         | 76.03  | 21.31     | True      |

**Details for table 2**

**350M**

| batch size | time/s | memory/GB | recompute |
| ---------- | -------| --------- | --------- |
| 4          | 56.46  | 16.30     | False     |
| 8          | 54.88  | 26.50     | False     |
| 16         | 71.06  | 16.10     | True      |
| 32         | 70.22  | 26.09     | True      |
| 64         | x      | OOM       | True      |

**760M**

| batch size | time/s | memory/GB | recompute |
| ---------- | -------| --------- | --------- |
| 4          | 51.82  | 13.82     | False     |
| 8          | 51.06  | 21.38     | False     |
| 16         | 62.99  | 12.67     | True      |
| 32         | 62.88  | 19.06     | True      |
| 64         | x      | OOM       | True      |

**1.3B**

| batch size | time/s | memory/GB | recompute |
| ---------- | -------| --------- | --------- |
| 4          | 49.35  | 12.77     | False     |
| 8          | 47.83  | 20.22     | False     |
| 16         | 60.01  | 10.67     | True      |
| 32         | 59.31  | 16.01     | True      |
| 64         | 58.81  | 26.67     | True      |
| 128        | x      | OOM       | True      |

**2.6B**

| batch size | time/s | memory/GB | recompute |
| ---------- | -------| --------- | --------- |
| 4          | 55.16  | 13.36     | False     |
| 8          | 55.10  | 21.47     | False     |
| 16         | 67.90  | 12.03     | True      |
| 32         | 67.56  | 18.85     | True      |
| 64         | x      | OOM       | True      |


**6.7B**

| batch size | time/s | memory/GB |
| ---------- | -------| --------- |
| 2          | 109.60 | 7.87      |
| 8          | 89.98  | 11.11     |
| 16         | 86.14  | 15.77     |
| 32         | 84.16  | 25.09     |
| 64         | x      | OOM       |
